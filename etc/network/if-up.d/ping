#!/bin/sh
. /etc/webc/webc.conf
server="http://ping.webconverger.org/"
sleeping=5

webcping () {
	logger "Pinging $server"
	wget -qO- --timeout=5 --post-data="M=$( 
		mac_address | md5sum | awk '{print $1}'
	)&V=${webc_version}" "$server"
}

lockdir=/var/run/webcping
test -f "$lockdir" && exit 0
touch "$lockdir"

while ! webcping
do

	logger "Failed to ping $server, sleeping $sleeping seconds"
	sleep "$sleeping"

done &
